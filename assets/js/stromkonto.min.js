$(".helptxt").click((function(){$(".helptxt").toggle()})),window.gsimap=function(t){$(".gsiloaded").hide(),$(".gsinozip").hide(),null==t?void 0!==$.getUrlVar("p")?window.gsimap($.getUrlVar("p")):void 0!==$.getUrlVar("q")?window.gsimap($.getUrlVar("q")):void 0!==$.getUrlVar("plz")?window.gsimap($.getUrlVar("plz")):void 0!==$.getUrlVar("zip")?window.gsimap($.getUrlVar("zip")):void 0!==$.getUrlVar("zipcode")?window.gsimap($.getUrlVar("zipcode")):$(".gsinozip").show():($(".gsinozip").hide(),$("#gsichart").correntlyGSI(t),$("#hknchart").correntlyHKNChart(t),$("#apiurls").append("Dispatch/Stromherkunft: <br/><pre>https://api.corrently.io/v2.0/gsi/dispatch?zip="+t+"</pre>"),$.getJSON("https://api.corrently.io/v2.0/gsi/dispatch?zip="+t,(function(t){$(".gsiloaded").show();var e=[];$("#fortext").html(t.center.city),$("#kmdistance").html(t.avg_distance_km.toFixed(1).replace(".",","));for(let a=0;a<t.dispatch_from.length;a++)e.push({location:new google.maps.LatLng(t.dispatch_from[a].location.coordinates[1],t.dispatch_from[a].location.coordinates[0]),weight:1e3*t.dispatch_from[a].energy});var a=new google.maps.LatLng(t.center.coordinates[1],t.center.coordinates[0]);map=new google.maps.Map(document.getElementById("map"),{center:a,zoom:11,mapTypeId:"hybrid"});var o=new google.maps.visualization.HeatmapLayer({data:e}),i=new google.maps.Marker({position:a,title:"Home"});o.setMap(map),o.set("radius",60),i.setMap(map)})))},window.stromkontoapp=function(){let t=$.getUrlVar("a");function e(){var t=window.location.hash;t&&$(`[data-toggle="tab"][href="${t}"]`).trigger("click")}void 0===t&&null!==window.localStorage.getItem("account")&&(t=window.localStorage.getItem("account")),null!=t&&window.localStorage.setItem("account",t),(void 0===t||null==t||t.length<5)&&("undefined"!=typeof _pag&&_paq.push(["trackEvent","Stromkonto","NewSession"]),$("#mlogin").modal(),$("#skologin").submit((function(t){console.log("Form Submit"),$("#email").val($("#skoemail").val());let e=$("#skologin").serialize();$.ajax({type:"POST",url:"https://api.corrently.io/v2.0/stromkonto/login",data:e,dataType:"json",success:function(t){"unregistered"!==t.status&&void 0!==t.stromkonto&&t.stromkonto.length>5?(window.localStorage.setItem("account",t.stromkonto),$("#memail").modal(),$("#mlogin").modal("hide"),"undefined"!=typeof _pag&&_paq.push(["trackEvent","Stromkonto","Login"])):($("#emailreg").val($("#skoemail").val()),$("#mlogin").modal("hide"),$("#mregi").modal(),$("#fregi").submit((function(t){$("#bemail").val($("#skoemail").val()),e=$("#fregi").serialize(),$.ajax({type:"POST",url:"https://api.corrently.io/v2.0/stromkonto/register",data:e,dataType:"json",success:function(t){$("#memail").modal()}}),$("#mregi").modal("hide"),"undefined"!=typeof _pag&&_paq.push(["trackEvent","Stromkonto","Register"]),t.preventDefault()})))},error:function(){}}),t.preventDefault()}))),$(".co2,.baeume,.eigenstrom,.erzeugung,.gsz").addClass("disabled"),$("#apiurls").append("Ledger Stromkonto: <br/><pre>https://api.corrently.io/v2.0/stromkonto/balances?account="+t+"</pre>"),$.getJSON("https://api.corrently.io/v2.0/stromkonto/balances?account="+t,(function(e){"0x7866f187f30cd52Bdbd5c4184fD3ee6168Ae0dB4"==t?$("#demoalert").show():$("#demoalert").hide();let a="";for(let t=0;t<e.length;t++){if($("."+e[t].variation).removeClass("disabled"),"gsi"==e[t].variation&&window.gsimap(e[t].zipcode),"co2"==e[t].variation&&e[t].saldo<0&&($("#negco2info").show(),$("#negaKWH").html(Math.round(Math.abs(e[t].saldo/.035)))),"submeter"==e[t].variation&&(a+="<tr>",a+="<td>"+e[t].name+"</td>",a+='<td style="text-align:right">'+(e[t].soll/1e3).toFixed(3).replace(".",",")+" kWh</td>",a+='<td style="text-align:right">'+(e[t].haben/1e3).toFixed(3).replace(".",",")+" kWh</td>",a+='<td style="text-align:right">'+(e[t].saldo/1e3).toFixed(3).replace(".",",")+" kWh</td>",a+='<td style="text-align:right">'+(e[t].gsb/1e3).toFixed(3).replace(".",",")+" kWh</td>",a+='<td style="text-align:right">'+(e[t].co2/1e3).toFixed(3).replace(".",",")+" kg</td>",a+="</tr>"),$.each(e[t],(function(a,o){"gsb"!=e[t].variation&&"gsz"!=e[t].variation&&"eigenstrom"!=e[t].variation&&"co2"!=e[t].variation||"soll"!=a&&"haben"!=a&&"saldo"!=a||(o=(o/1e3).toFixed(3).replace(".",",")),$("."+e[t].variation+'[data="'+a+'"]').html(o)})),void 0!==e[t].txs){e[t].txs.sort((t,e)=>t.timeStamp<e.timeStamp?1:e.timeStamp<t.timeStamp?-1:0);let a='<table class="table table-condensed">';a+='<tr class="d-flex"><th class="col-2">Datum</th><th class="col-8">Beschreibung</th><th class="col-2" align="right" style="text-align:right">Wert</th></tr>';let o=e[t].saldo;if(void 0===window.pageMore&&(window.pageMore={}),void 0===window.pageMore[e[t].variation]&&(window.pageMore[e[t].variation]=0),"gsb"==e[t].variation&&e[t].txs.length>1){let a=e[t].txs[0].timeStamp-e[t].txs[1].timeStamp,o=e[t].txs[0].value,i=(35e3-e[t].saldo)/o*a/36e5;$("#countdownGSB").html(i.toFixed(1).replace(".",",")+" Stunden")}for(let i=0;i<e[t].txs.length&&i<24;i++){o-=e[t].txs[i].value,"gsb"!=e[t].variation&&"gsz"!=e[t].variation&&"eigenstrom"!=e[t].variation&&"co2"!=e[t].variation||(e[t].txs[i].value=(e[t].txs[i].value/1e3).toFixed(3).replace(".",","));let l="less8";i<8&&(l="top8"),a+="<tr class='d-flex "+l+"'>",a+="<td class='col-2' title='"+e[t].txs[i].txid+"'>"+new Date(e[t].txs[i].timeStamp).toLocaleString()+"</td>",a+="<td class='col-8' title='Geprüft: "+e[t].txs[i].cashier+"'>"+e[t].txs[i].txt+"</td>",a+="<td class='col-2' align='right' style='text-align:right'>"+e[t].txs[i].value+"</td>",a+="</tr>"}a+="<tr class='d-flex'><td  class='col-2'>&nbsp;</td><td class='col-8 text-muted'>aus vorhergehenden Transaktionen</td>","gsb"!=e[t].variation&&"eigenstrom"!=e[t].variation||(o=(o/1e3).toFixed(3).replace(".",",")),a+="<td class='col-2 text-muted' style='text-align:right'>"+o+"</td></tr>",a+="</table>",$("."+e[t].variation+'[data="txtable"]').html(a)}if(void 0!==e[t].assets){let a='<table class="table table-condensed">';a+='<tr class="d-flex"><th class="col-5">Erzeugungsanlage</th><th class="col-5">Betreiber/Emitent</th><th class="col-2" align="right" style="text-align:right">Anteile (kwha)</th></tr>';for(let o=0;o<e[t].assets.length&&o<50;o++)a+="<tr class='d-flex'>",a+="<td class='col-5' title='"+e[t].assets[o].account+"'>"+e[t].assets[o].asset_title+"</td>",a+="<td class='col-5' title='Vertragskennung: "+e[t].assets[o].asset_contract+"'>"+e[t].assets[o].asset_emitent+"</td>",a+="<td class='col-2' align='right' style='text-align:right'>"+e[t].assets[o].shares+"</td>",a+="</tr>";a+="</table>",$("."+e[t].variation+'[data="assettable"]').html(a)}}$("#submeterTable").html(a)})),window.addEventListener("hashchange",e,!1),e()},$(document).ready((function(){try{location.pathname.indexOf("gruenstromindex")>0||document.title.indexOf("GrünstromIndex")>-1||location.pathname.indexOf("entfernung")>0?window.gsimap():window.stromkontoapp()}catch(t){console.log(t)}})),$(".modbut").click((function(){$("#apiinfo").modal()})),$(".gsbChkOut").click((function(){Stripe("pk_live_rWnhwGfKnwm2aMYyQ50SbZrl").redirectToCheckout({items:[{sku:"sku_FPdNXJvUGdZ1hi",quantity:1}],successUrl:"https://corrently.de/service/stromkonto.html",cancelUrl:"https://corrently.de/service/stromkonto.html",clientReferenceId:window.ce_zip}).then((function(t){}))})),$(".baumChkOut").click((function(){Stripe("pk_live_rWnhwGfKnwm2aMYyQ50SbZrl").redirectToCheckout({items:[{sku:"sku_IiYzSpflKmbtJ3",quantity:1}],successUrl:"https://corrently.de/service/stromkonto.html",cancelUrl:"https://corrently.de/service/stromkonto.html",clientReferenceId:window.ce_zip}).then((function(t){}))}));